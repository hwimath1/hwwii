<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>일차방정식의 활용</title>

  <!-- MathJax for LaTeX rendering -->
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" defer></script>

  <style>
    body {
      margin: 0; padding: 0;
      font-family: sans-serif;
      background: #f2f2f2;
      color: #333;
    }
    h1, h2, h3 {
      text-align: center;
    }
    #gameContainer {
      max-width: 800px;
      margin: 0 auto;
      padding: 1rem;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      display: none; /* 처음에는 숨김 */
    }
    #introContainer {
      max-width: 800px;
      margin: 0 auto;
      text-align: center;
      background: #fff;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .energy-bar {
      width: 100%;
      height: 20px;
      background: #ddd;
      position: relative;
      margin-bottom: 10px;
      border-radius: 10px;
      overflow: hidden;
    }
    .energy-fill {
      height: 100%;
      background: linear-gradient(90deg, #4caf50, #8bc34a);
      width: 100%; /* 실제 동적으로 변경 */
      transition: width 0.3s;
    }
    .question-box {
      margin-bottom: 1rem;
      padding: 1rem;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    .answers {
      list-style: none;
      padding: 0;
    }
    .answers li {
      background: #fafafa;
      margin: 0.3rem 0;
      padding: 0.5rem;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .answers li:hover {
      background: #f0f0f0;
    }
    .centered {
      text-align: center;
    }
    .score-box, .life-box {
      display: inline-block;
      margin: 0 15px;
      font-weight: bold;
    }
    .hidden {
      display: none;
    }
    #response {
      white-space: pre;
      background: #f9f9f9;
      border: 1px solid #ccc;
      margin-top: 0.5rem;
      padding: 0.5rem;
      height: 120px;
      overflow: auto;
      border-radius: 4px;
    }
    /* 난이도 라디오 버튼 */
    .difficulty-group {
      text-align: center;
      margin: 1rem 0;
    }
    .difficulty-group label {
      margin: 0 1rem;
      cursor: pointer;
    }
    .info-bar {
      text-align: center;
      margin-bottom: 0.5rem;
    }
    .time-box {
      display: inline-block;
      margin: 0 15px;
      font-weight: bold;
    }
    .name-input {
      margin: 1rem 0;
      text-align: center;
    }
    .name-input input {
      width: 200px;
      padding: 0.5rem;
      font-size: 1rem;
    }
    button {
      cursor: pointer;
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 4px;
      background: #2196f3;
      color: #fff;
      font-size: 1rem;
      margin: 0.5rem;
    }
    button:hover {
      background: #1b7fc0;
    }
  </style>
</head>
<body>

<div id="introContainer">
  <h1>일차방정식의 활용</h1>
  <div class="name-input">
    <label for="userName">이름을 입력하세요</label><br/>
    <input type="text" id="userName" placeholder="이름" />
  </div>
  <div class="difficulty-group">
    <p>난이도를 선택하세요</p>
    <label><input type="radio" name="difficulty" value="top"/> 최상 (30초 시작, +20점)</label>
    <label><input type="radio" name="difficulty" value="high"/> 상 (40초 시작, +15점)</label>
    <label><input type="radio" name="difficulty" value="mid"/> 중 (50초 시작, +13점)</label>
    <label><input type="radio" name="difficulty" value="low" checked/> 하 (무제한, +10점)</label>
  </div>
  <button id="startBtn">게임 시작</button>
</div>

<div id="gameContainer">
  <div class="info-bar">
    <div class="score-box">점수: <span id="score">0</span></div>
    <div class="life-box">남은 기회: <span id="life">3</span></div>
    <div class="time-box">총 경과 시간: <span id="elapsed">0</span>초</div>
  </div>

  <div class="energy-bar">
    <div class="energy-fill" id="energyFill"></div>
  </div>

  <div id="questionArea" class="question-box">
    <!-- 문제 & 보기 표시 영역 -->
    <div id="conditions"></div>
    <div id="question"></div>
    <ul class="answers" id="answersList">
      <!-- 보기 4개 동적 생성 -->
    </ul>
  </div>

  <div class="centered">
    <button id="nextBtn" class="hidden">다음 문제</button>
    <button id="endBtn" class="hidden">게임 종료</button>
  </div>

  <div class="centered">
    <button id="sendScoreBtn" class="hidden">점수 전송</button>
    <div id="response"></div>
  </div>
</div>

<script>
// [요청하신 saveData 함수 - 점수 전송용]
function saveData(game, name, score, elapsedTime) {
    const FUNCTION_URL = "https://us-central1-record-f420d.cloudfunctions.net/report";

    const requestData = {
        game,
        name,
        score: parseInt(score, 10),
        elapsedTime: parseInt(elapsedTime, 10)
    };

    fetch(FUNCTION_URL, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(requestData)
    })
    .then(async (res) => {
      const responseData = await res.json();
      if (res.ok) {
        document.getElementById('response').innerText =
          `성공: ${JSON.stringify(responseData, null, 2)}`;
      } else {
        document.getElementById('response').innerText =
          `오류: ${JSON.stringify(responseData, null, 2)}`;
      }
    })
    .catch(error => {
      console.error('요청 실패:', error);
      document.getElementById('response').innerText =
          `네트워크 오류: ${error.message}`;
    });
}

// 문제 및 보기 데이터를 저장할 배열 (총 33문제)
// 조건 + 문제 + 보기 + 정답 + 간단 해설/설명
// 라텍스 분수는 \\(\\dfrac{}{}\\) 형태 주의
// 문제 순서 섞기, 보기 섞기 등 모두 구현
// 아래 각 문제는 "모두" 포함 (하나도 빠짐없이)
const allProblems = [

  // 1) [방정식 문제 7문제]
  {
    conditions: "조건: 어떤 수 \\(x\\)의 3배는 그 수에 6을 더한 것과 같다.",
    question: "이때 \\(x\\)의 값은 얼마인가?",
    answers: ["2", "3", "6", "9"],
    correct: 1, // 정답 = "3"
    explanation: "식: \\(3x = x + 6\\) → \\(2x = 6\\) → \\(x=3\\)."
  },
  {
    conditions: "조건: 어떤 수 \\(x\\)에 10을 더하면 그 수의 3배가 된다.",
    question: "이때 \\(x\\)의 값은 얼마인가?",
    answers: ["3", "5", "10", "15"],
    correct: 1, // 정답 = "5"
    explanation: "식: \\(x+10=3x\\) → \\(10=2x\\) → \\(x=5\\)."
  },
  {
    conditions: "조건: \\(x\\)를 2배해서 3을 빼면, 원래 \\(x\\)보다 5 큰 수가 된다.",
    question: "이때 \\(x\\)의 값은 얼마인가?",
    answers: ["5", "7", "8", "10"],
    correct: 2, // 정답 = "8"
    explanation: "식: \\(2x-3 = x+5\\) → \\(x=8\\)."
  },
  {
    conditions: "조건: \\(x\\)에서 4를 뺀 값의 2배는 16과 같다.",
    question: "이때 \\(x\\)의 값은 얼마인가?",
    answers: ["8", "12", "14", "20"],
    correct: 1, // 정답 = "12"
    explanation: "식: \\(2(x-4)=16\\) → \\(x-4=8\\) → \\(x=12\\)."
  },
  {
    conditions: "조건: 300원짜리 과자 5봉지와 500원짜리 음료수 \\(x\\)병을 사서 5000원을 지불했다.",
    question: "음료수 병 수 \\(x\\)는 얼마인가?",
    answers: ["5", "7", "8", "10"],
    correct: 1, // 정답="7"
    explanation: "식: \\(300\\times5 + 500x=5000\\)→\\(1500+500x=5000\\)→\\(x=7\\)."
  },
  {
    conditions: "조건: 한 변의 길이가 \\(x\\)인 정사각형의 둘레가 30이다.",
    question: "한 변 \\(x\\)의 길이는 얼마인가?",
    answers: ["5.5", "6", "7.5", "10"],
    correct: 2, // 정답="7.5" (index 2)
    explanation: "식: \\(4x=30\\)→\\(x=7.5\\)."
  },
  {
    conditions: "조건: 사과 40개를 3명에게 \\(x\\)개씩 나누어 주었더니 2개가 남았다.",
    question: "\\(x\\)의 값은 얼마인가?",
    answers: ["12", "12.5", "12.6", "12\\(\\dfrac{2}{3}\\)"],
    correct: 3, // 정답 index=3 => "12(2/3)"
    explanation: "식: \\(40=3x+2\\)→\\(3x=38\\)→\\(x=\\dfrac{38}{3}\\)."
  },

  // 2) [연속 정수 4문제]
  {
    conditions: "조건: 연속하는 세 정수의 합이 27이다.",
    question: "이 세 정수는 어느 것인가?",
    answers: ["7,8,9", "8,9,10", "9,10,11", "10,11,12"],
    correct: 1, // "8,9,10"
    explanation: "가운데 정수 x라 하면 \\((x-1)+x+(x+1)=27\\) → \\(3x=27\\)→\\(x=9\\)."
  },
  {
    conditions: "조건: 연속하는 세 정수의 합이 69이다.",
    question: "이 세 정수는 어느 것인가?",
    answers: ["21,22,23", "22,23,24", "23,24,25", "24,25,26"],
    correct: 1, // "22,23,24"
    explanation: "가운데 정수 x라 하면 \\((x-1)+x+(x+1)=69\\) → \\(3x=69\\)→\\(x=23\\)."
  },
  {
    conditions: "조건: 연속하는 세 짝수의 합이 18이다.",
    question: "이 세 짝수는 어느 것인가?",
    answers: ["2,4,6", "4,6,8", "6,8,10", "8,10,12"],
    correct: 1, // "4,6,8"
    explanation: "가운데 짝수 x라 하면 \\((x-2)+x+(x+2)=18\\)→\\(3x=18\\)→\\(x=6\\)."
  },
  {
    conditions: "조건: 연속하는 세 짝수의 합이 30이다.",
    question: "이 세 짝수는 어느 것인가?",
    answers: ["6,8,10", "8,10,12", "10,12,14", "12,14,16"],
    correct: 1, // "8,10,12"
    explanation: "가운데 짝수 x라 하면 \\((x-2)+x+(x+2)=30\\)→\\(3x=30\\)→\\(x=10\\)."
  },

  // 3) [아버지 아들 나이 문제 총 6문제]
  // 첫 세트 (41세·14세 / 46세·14세)
  {
    conditions: "조건: 아버지 현재 41세, 아들 현재 14세.",
    question: "몇 년 후에 아버지 나이가 아들의 나이의 2배가 되는가?",
    answers: ["10", "13", "15", "18"],
    correct: 1, // 13
    explanation: "\\(41+x=2(14+x)\\)→\\(41+x=28+2x\\)→x=13."
  },
  {
    conditions: "조건: 아버지 현재 46세, 아들 현재 14세.",
    question: "몇 년 후에 아버지 나이가 아들의 나이의 2배가 되는가?",
    answers: ["16", "18", "20", "22"],
    correct: 1, // 18
    explanation: "\\(46+x=2(14+x)\\)→\\(46+x=28+2x\\)→x=18."
  },

  // 두 번째 세트(“두 번째 사진” 빼고)
  {
    conditions: "조건: 아버지 41세, 아들 14세. (중복 문장 삭제)",
    question: "몇 년 후에 아버지 나이가 아들의 나이의 2배가 되는가?",
    answers: ["10", "13", "15", "18"],
    correct: 1,
    explanation: "동일 계산 → x=13."
  },
  {
    conditions: "조건: 아버지 46세, 아들 14세. (중복 문장 삭제)",
    question: "몇 년 후에 아버지 나이가 아들의 나이의 2배가 되는가?",
    answers: ["16", "18", "20", "22"],
    correct: 1,
    explanation: "동일 계산 → x=18."
  },

  // 세 번째 세트(더 문장 빼고)
  {
    conditions: "조건: 아버지 41세, 아들 14세. (추가 문장 더 제거)",
    question: "몇 년 후에 아버지 나이가 아들의 나이의 2배가 되는가?",
    answers: ["10", "13", "15", "18"],
    correct: 1,
    explanation: "역시 x=13."
  },
  {
    conditions: "조건: 아버지 46세, 아들 14세. (추가 문장 더 제거)",
    question: "몇 년 후에 아버지 나이가 아들의 나이의 2배가 되는가?",
    answers: ["16", "18", "20", "22"],
    correct: 1,
    explanation: "역시 x=18."
  },

  // 4) [사과 나누기 2문제]
  {
    conditions: "조건: 학생 x명에게 사과를 나누어 준다. 4개씩 나누어 주면 6개 남고, 5개씩 나누어 주면 4개 부족하다.",
    question: "사과의 총 개수는 몇 개인가?",
    answers: ["34", "40", "46", "52"],
    correct: 2, // 46
    explanation: "식: 4x+6=5x-4 → x=10 → 총 46개"
  },
  {
    conditions: "조건: 학생 x명에게 사과를 나누어 준다. 4개씩 나누어 주면 6개 남고, 5개씩 나누어 주면 4개 부족하다.",
    question: "학생 수 x는 몇 명인가?",
    answers: ["8", "9", "10", "12"],
    correct: 2, // 10
    explanation: "4x+6=5x-4 → x=10."
  },

  // 5) [거리·시간·속력 + 소금물 10문제]
  // 48) 49) 50) 51) 52) 53) 59) 60) 61) 62)
  {
    conditions: "조건: 거리가 5 km, 시속 2 km 로 이동",
    question: "걸리는 시간은 얼마인가?",
    answers: ["2시간", "2시간10분", "2시간30분", "3시간"],
    correct: 2, // "2시간30분"
    explanation: "\\(\\dfrac{5}{2}=2.5\\)시간 → 2시간30분"
  },
  {
    conditions: "조건: 거리가 91 m, 분속 7 m로 이동",
    question: "걸리는 시간은 몇 분인가?",
    answers: ["11분", "12분", "13분", "15분"],
    correct: 2,
    explanation: "\\(\\dfrac{91}{7}=13\\)분"
  },
  {
    conditions: "조건: 거리 8 km, 걸린 시간 4시간",
    question: "이동 속력(시속)은 얼마인가?",
    answers: ["1 km/h", "2 km/h", "2.5 km/h", "3 km/h"],
    correct: 1,
    explanation: "\\(\\dfrac{8}{4}=2\\)km/h"
  },
  {
    conditions: "조건: 거리 480 m, 걸린 시간 4분",
    question: "이동 속력(분속)은 얼마인가?",
    answers: ["80 m/분", "100 m/분", "120 m/분", "140 m/분"],
    correct: 2,
    explanation: "\\(\\dfrac{480}{4}=120\\)m/분"
  },
  {
    conditions: "조건: 시속 70 km, 총 240분(4시간) 동안 이동",
    question: "이동 거리는 몇 km인가?",
    answers: ["240 km", "280 km", "300 km", "340 km"],
    correct: 1,
    explanation: "70 km/h × 4h = 280 km"
  },
  {
    conditions: "조건: 분속 20 m, 1시간(60분) 동안 이동",
    question: "이동 거리는 몇 m인가?",
    answers: ["1000 m", "1100 m", "1200 m", "1400 m"],
    correct: 2,
    explanation: "20 m/분 × 60분 = 1200 m"
  },
  {
    conditions: "조건: 8% 소금물 300 g에 소금 10 g 더 넣음",
    question: "이 소금물에 들어있는 소금의 양(총 g)은 얼마인가?",
    answers: ["30 g", "34 g", "35 g", "40 g"],
    correct: 1,
    explanation: "8% of 300 g=24 g, +10 g=34 g"
  },
  {
    conditions: "조건: 3% 소금물 300 g + 5% 소금물 200 g 섞음",
    question: "혼합액에 들어있는 소금의 양(총 g)은 얼마인가?",
    answers: ["15 g", "17 g", "19 g", "21 g"],
    correct: 2,
    explanation: "3% of 300=9 g, 5% of 200=10 g, 합=19 g"
  },
  {
    conditions: "조건: 5% 소금물 600 g에서 물 100 g 증발",
    question: "증발 후 소금물 농도(%)는 얼마인가?",
    answers: ["4%", "6%", "8%", "10%"],
    correct: 1,
    explanation: "5% of 600=30 g, 남은액 500 g, 농도=30/500×100=6%"
  },
  {
    conditions: "조건: 5% 소금물 100 g과 13% 소금물 300 g 섞음",
    question: "혼합 소금물 농도(%)는 얼마인가?",
    answers: ["9%", "10%", "11%", "12%"],
    correct: 2,
    explanation: "5 g+39 g=44 g, 전체400 g, 44/400×100=11%"
  },

  // 6) [새로 추가한 10% 소금물 문제 1문제 => 총 30]
  {
    conditions: "조건: 10% 소금물 200 g에 물 x g을 더 넣어 8% 소금물을 만든다.",
    question: "더 넣을 물 x는 몇 g인가?",
    answers: ["40 g","45 g","50 g","60 g"],
    correct: 2,
    explanation: "10% of 200=20 g, 8%→ 8(200+x)=2000, x=50"
  },

  // 7) [작업률 문제 3문제 => 총 33]
  {
    conditions: "정호 혼자 12일, 세리 혼자 15일 걸림. 처음 둘이 x일 함께, 이후 세리 빠지고 정호 혼자 3일 마무리.",
    question: "정호와 세리가 함께 일한 기간(x)은 며칠인가?",
    answers: ["3일","4일","5일","6일"],
    correct: 2,
    explanation: "식: x(1/12+1/15)+3(1/12)=1 → x=5"
  },
  {
    conditions: "A 혼자 15일, B 혼자 18일. A가 4일 혼자 후, 남은 걸 A,B 함께 끝냄.",
    question: "A와 B가 함께 일한 기간은 며칠인가?",
    answers: ["5일","6일","7일","8일"],
    correct: 1,
    explanation: "남은 일이 11/15, 하루 작업 (1/15+1/18)=11/90,  (11/15)/(11/90)=6일"
  },
  {
    conditions: "A 혼자 10일, B 혼자 6일. A 혼자 2일 후, 남은 일 A,B 함께 마무리.",
    question: "전체 일을 완료하는 데 걸린 총 일수는 얼마인가?",
    answers: ["4일","5일","6일","7일"],
    correct: 1,
    explanation: "A 2일 →2/10, 남은4/5, 하루(1/10+1/6)=4/15,  (4/5)/(4/15)=3일, 합 5일"
  }

];

// 문제 중복 방지용 인덱스
let usedIndices = [];
// 난이도별 제한 시간(초)
let timeLimit = 9999999; // 하 난이도(무제한 비슷)
let pointPerQuestion = 10; // 하 난이도 기본
// 에너지(현재 남은 초) - 난이도별 초기화
let currentEnergy = timeLimit;

let score = 0;
let life = 3;
let elapsedTime = 0; // 게임 시작 후 경과 시간(초)
let timerId = null;
let totalTimerId = null;
let currentProblemIndex = -1;

// 난이도별 설정 함수
function setDifficulty(dif) {
  if (dif === "top") {
    timeLimit = 30;
    pointPerQuestion = 20;
  } else if (dif === "high") {
    timeLimit = 40;
    pointPerQuestion = 15;
  } else if (dif === "mid") {
    timeLimit = 50;
    pointPerQuestion = 13;
  } else {
    // 하
    timeLimit = 9999999; // 사실상 무제한
    pointPerQuestion = 10;
  }
}

// 배열 무작위 섞기
function shuffleArray(arr) {
  for (let i = arr.length -1; i>0; i--) {
    const j = Math.floor(Math.random()* (i+1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
}

// 보기 섞기 (indices)
function shuffleAnswersIndices() {
  const indices = [0,1,2,3];
  for (let i = indices.length -1; i>0; i--) {
    const j = Math.floor(Math.random()*(i+1));
    [indices[i], indices[j]] = [indices[j], indices[i]];
  }
  return indices;
}

function pickRandomProblem() {
  if (usedIndices.length === allProblems.length) {
    // 모든 문제를 다 풀었다면 종료 처리
    endGame();
    return null;
  }
  let idx;
  do {
    idx = Math.floor(Math.random()* allProblems.length);
  } while (usedIndices.includes(idx));

  usedIndices.push(idx);
  return allProblems[idx];
}

function loadProblem() {
  document.getElementById('nextBtn').classList.add('hidden');
  document.getElementById('endBtn').classList.add('hidden');

  const p = pickRandomProblem();
  if (!p) return;

  currentProblemIndex = p; // 객체 자체를 저장
  document.getElementById('conditions').innerHTML = "<b>[조건]</b><br/>" + p.conditions;
  document.getElementById('question').innerHTML = "<b>[문제]</b> " + p.question;

  // 보기 4개
  const answersUl = document.getElementById('answersList');
  answersUl.innerHTML = "";

  // 보기 인덱스 섞기
  const shuffled = shuffleAnswersIndices();
  for (let i=0; i<4; i++){
    const li = document.createElement('li');
    const realIndex = shuffled[i];
    li.innerHTML = p.answers[realIndex]; 
    li.addEventListener("click", () => {
      checkAnswer(realIndex);
    });
    answersUl.appendChild(li);
  }

  // MathJax 렌더링
  MathJax.typeset();
}

// 정답 체크
function checkAnswer(chosenIndex) {
  // 정답 인덱스 (p.correct)
  const correctIndex = currentProblemIndex.correct;
  const correctText = currentProblemIndex.answers[correctIndex];

  if (chosenIndex === correctIndex) {
    // 정답
    alert("정답입니다!");
    score += pointPerQuestion;
    document.getElementById('score').innerText = score;
  } else {
    // 오답
    alert("틀렸습니다! 정답: " + correctText);
    life--;
    document.getElementById('life').innerText = life;
    if (life <= 0) {
      // 게임 오버
      endGame();
      return;
    }
  }
  // 다음 문제 버튼 표시
  document.getElementById('nextBtn').classList.remove('hidden');
  // 보기 클릭 막기
  const answersUl = document.getElementById('answersList');
  for (let li of answersUl.children) {
    li.style.pointerEvents = "none";
  }
}

// 다음 문제
function goNextProblem() {
  resetEnergy(); // 에너지바 다시 채우고 시작
  loadProblem();
}

// 게임 종료
function endGame() {
  clearInterval(timerId);
  clearInterval(totalTimerId);
  alert("게임이 종료되었습니다. 최종 점수: "+score);
  // 종료 UI
  document.getElementById('nextBtn').classList.add('hidden');
  document.getElementById('endBtn').classList.add('hidden');
  document.getElementById('sendScoreBtn').classList.remove('hidden');
}

// 에너지(시간) 초기화
function resetEnergy() {
  if (timeLimit > 999999) {
    // 하 난이도 (무제한)
    currentEnergy = 9999999;
  } else {
    currentEnergy = timeLimit;
  }
}

function updateEnergyBar() {
  const bar = document.getElementById('energyFill');
  if (timeLimit > 999999) {
    // 무제한이면 그냥 고정
    bar.style.width = "100%";
    return;
  }
  // 제한 시간 모드
  const ratio = currentEnergy / timeLimit;
  bar.style.width = (ratio*100)+"%";
}

function gameTimerTick() {
  if (timeLimit <= 999999) {
    currentEnergy -= 1;
    if (currentEnergy <= 0) {
      // 시간 초과 -> 기회 감소
      life--;
      document.getElementById('life').innerText = life;
      if (life<=0) {
        endGame();
        return;
      }
      // 새로운 문제로 넘어가기
      alert("시간이 초과되었습니다! 기회 1 감소!");
      goNextProblem();
    }
  }
  updateEnergyBar();
}

// 총 경과 시간
function totalTimeTick() {
  elapsedTime++;
  document.getElementById('elapsed').innerText = elapsedTime;
}

document.getElementById('startBtn').addEventListener("click", () => {
  const nameVal = document.getElementById('userName').value.trim();
  if (!nameVal) {
    alert("이름을 입력해주세요.");
    return;
  }

  // 난이도 선택
  const difRadio = document.querySelector('input[name="difficulty"]:checked');
  if (!difRadio) {
    alert("난이도를 선택해주세요.");
    return;
  }
  setDifficulty(difRadio.value);

  document.getElementById('introContainer').style.display = "none";
  document.getElementById('gameContainer').style.display = "block";

  // 문제 배열 자체도 무작위 섞기
  // (하지만 pickRandomProblem에서 중복 안되게 뽑으므로 여기서는 생략 가능)
  // shuffleArray(allProblems);

  resetEnergy();
  updateEnergyBar();
  loadProblem();

  timerId = setInterval(gameTimerTick, 1000);
  totalTimerId = setInterval(totalTimeTick, 1000);
});

document.getElementById('nextBtn').addEventListener("click", () => {
  goNextProblem();
});

document.getElementById('endBtn').addEventListener("click", () => {
  endGame();
});

document.getElementById('sendScoreBtn').addEventListener("click", () => {
  const nameVal = document.getElementById('userName').value.trim();
  saveData("일차방정식의 활용", nameVal, score, elapsedTime);
});

// 첫 렌더
</script>

</body>
</html>
